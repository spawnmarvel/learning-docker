# Docker volume

With the previous experiment, you saw that each container starts from the image definition each time it starts. While containers can create, update, and delete files, those changes are lost when you remove the container and Docker isolates all changes to that container. 

With volumes, you can change all of this.

Volumes provide the ability to connect specific filesystem paths of the container back to the host machine. 

If you mount a directory in the container, changes in that directory are also seen on the host machine. 

If you mount that same directory across container restarts, you'd see the same files.

There are two main types of volumes. You'll eventually use both, but you'll start with volume mounts.

https://docs.docker.com/storage/volumes/

## Volumes

Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. 

While bind mounts are dependent on the directory structure and OS of the host machine, volumes are completely managed by Docker. 

Volumes have several advantages over bind mounts:

* Volumes are easier to back up or migrate than bind mounts.
* You can manage volumes using Docker CLI commands or the Docker API.
* Volumes work on both Linux and Windows containers.
* Volumes can be more safely shared among multiple containers.
* Volume drivers let you store volumes on remote hosts or cloud providers, encrypt the contents of volumes, or add other functionality.
* New volumes can have their content pre-populated by a container.
* Volumes on Docker Desktop have much higher performance than bind mounts from Mac and Windows hosts.

* In addition, volumes are often a better choice than persisting data in a container's writable layer:
* Because a volume doesn't increase the size of the containers using it, and the volume's contents exist outside the lifecycle of a given container.

## Choose the -v or --mount flag

If you need to specify volume driver options, you must use --mount.

* -v or --volume: Consists of three fields, separated by colon characters (:). The fields must be in the correct order, and the meaning of each field isn't immediately obvious.


## The todo-app

```bash
# Create a volume by using the docker volume create command.
docker volume create todo-db

# view it
docker volume ls


# Start the todo app container, but add the --mount option to specify a volume mount. 
# Give the volume a name, and mount it to /etc/todos in the container, which captures all files created at the path
# By default, the todo app stores its data in a SQLite database at /etc/todos/todo.db in the container's filesystem.
docker run -dp 192.168.3.4:3000:3000 --mount type=volume,src=todo-db,target=/etc/todos getting-started

docker volume inspect todo-db

[
    {
        "CreatedAt": "2023-12-29T17:06:14Z",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/todo-db/_data",
        "Name": "todo-db",
        "Options": null,
        "Scope": "local"
    }
]

# The Mountpoint is the actual location of the data on the disk. 
# Note that on most machines, you will need to have root access to access this directory from the host.

sudo su -

cd

pwd
# /var/lib/docker/volumes/todo-db/_data


```

## Example RabbitMQ

